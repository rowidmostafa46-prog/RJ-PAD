<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø­Ø±ÙŠØ± | ÙØ®Ø± Ø§Ù„Ø±ÙˆØ§ÙŠØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</title>
    <meta name="description" content="Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø­Ø±ÙŠØ± Ù‡ÙŠ ÙˆØ¬Ù‡ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆÙ†Ø´Ø± Ø§Ù„Ø±ÙˆØ§ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø§Ù†Ø¬Ø§ Ù…Ø¬Ø§Ù†Ø§Ù‹. Ø§ÙƒØªØ´Ù Ø¹Ø§Ù„Ù…Ø§Ù‹ Ù…Ù† Ø§Ù„Ø®ÙŠØ§Ù„ ÙˆØ§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø¹Ø±Ø¨ÙŠ.">
    <meta name="keywords" content="Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø­Ø±ÙŠØ±, Ø±ÙˆØ§ÙŠØ§Øª, Ù‚Ø±Ø§Ø¡Ø©, Ù†Ø´Ø± Ø±ÙˆØ§ÙŠØ§Øª, PDF, Ù…Ø§Ù†Ø¬Ø§ Ø¹Ø±Ø¨ÙŠØ©, ÙˆØ§ØªØ¨Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¨">
    <link rel="canonical" href="https://rowidmostafa46-prog.github.io/RJ-PAD/">
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #050505; --accent: #8b0000; --text: #e0e0e0; --card: #121212; --gold: #ffd700; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Cairo', sans-serif; margin: 0; scroll-behavior: smooth; }
        header { background: linear-gradient(135deg, #000, var(--accent)); padding: 40px 20px; text-align: center; border-bottom: 4px solid var(--accent); }
        .logo { font-size: 3.5rem; font-weight: 900; letter-spacing: 10px; text-shadow: 0 0 20px #ff0000; margin: 0; }
        .container { max-width: 1200px; margin: auto; padding: 20px; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ */
        .search-container { position: sticky; top: 10px; z-index: 100; margin-bottom: 30px; }
        .search-box { width: 100%; padding: 15px; background: rgba(0,0,0,0.9); border: 2px solid var(--accent); color: white; border-radius: 50px; font-size: 1.1rem; box-sizing: border-box; box-shadow: 0 5px 15px rgba(255,0,0,0.2); text-align: center; }

        /* Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù†Ø´Ø± Ù„Ù„Ù…Ø¤Ù„ÙÙŠÙ† */
        .tutorial-box { background: #1a1a1a; padding: 25px; border-radius: 15px; border-right: 5px solid var(--gold); margin-bottom: 30px; }
        .tutorial-box h3 { color: var(--gold); margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .guide-step { font-size: 0.95rem; margin-bottom: 10px; color: #ccc; }
        .guide-step b { color: var(--gold); }

        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± */
        .publish-box { background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid var(--accent); margin-bottom: 50px; display: none; }
        input, textarea { width: 100%; padding: 15px; margin: 10px 0; background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 8px; box-sizing: border-box; font-family: 'Cairo'; }
        #submitBtn { background: var(--accent); color: white; border: none; padding: 15px; cursor: pointer; font-weight: bold; border-radius: 8px; width: 100%; font-size: 1.2rem; transition: 0.3s; }
        #submitBtn:hover { background: #ff0000; box-shadow: 0 0 15px #ff0000; }

        /* Ø´Ø¨ÙƒØ© Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙˆØ§ÙŠØ§Øª */
        .stories-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
        .story-card { background: var(--card); border-radius: 15px; overflow: hidden; border: 1px solid #222; transition: 0.3s; }
        .story-card:hover { transform: translateY(-8px); border-color: var(--accent); }
        .story-cover { width: 100%; height: 380px; object-fit: cover; }
        .story-info { padding: 15px; }
        .btn-read { display: block; background: #ff4d4d; color: #fff; text-align: center; padding: 12px; text-decoration: none; font-weight: bold; border-radius: 8px; margin-top: 10px; transition: 0.2s; }
        .btn-read:hover { background: #fff; color: #ff4d4d; }
        .delete-btn { background: transparent; color: #ff4444; border: 1px solid #444; padding: 5px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 10px; font-size: 0.8rem; }

        #loginBtn { background: #fff; color: #000; padding: 12px 30px; border-radius: 30px; cursor: pointer; border: none; font-weight: 900; margin-top: 20px; }
    </style>
</head>
<body>

<header>
    <h1 class="logo">Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø­Ø±ÙŠØ±</h1>
    <p>âš¡ Ù†Ø³Ø¬ Ø§Ù„ÙƒÙ„Ù…Ø§Øª.. ÙˆÙØ®Ø± Ø§Ù„Ø±ÙˆØ§ÙŠØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© âš¡</p>
    <button id="loginBtn">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø¯Ø¹ÙŠÙ† (Google)</button>
</header>

<div class="container">
    <div class="tutorial-box">
        <h3>ğŸš€ ÙƒÙŠÙ ØªÙ†Ø´Ø± Ø¹Ù…Ù„Ùƒ ÙˆØªØ¬Ø¹Ù„Ù‡ ÙŠÙØªØ­ Ù„Ù„Ø¬Ù…ÙŠØ¹ØŸ</h3>
        <div class="guide-step">1ï¸âƒ£ <b>Ø§Ù„Ø±ÙØ¹:</b> Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ù€ PDF Ø¹Ù„Ù‰ Google Drive.</div>
        <div class="guide-step">2ï¸âƒ£ <b>Ø§Ù„Ø®ØµÙˆØµÙŠØ©:</b> Ø§Ø¶ØºØ· Share ÙˆØ§Ø¬Ø¹Ù„ Ø§Ù„ÙˆØµÙˆÙ„ <b>"Anyone with the link"</b> (Ø£ÙŠ Ø´Ø®Øµ Ù„Ø¯ÙŠÙ‡ Ø§Ù„Ø±Ø§Ø¨Ø·).</div>
        <div class="guide-step">3ï¸âƒ£ <b>Ø§Ù„Ø±Ø§Ø¨Ø·:</b> Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„. Ø³ÙŠÙ‚ÙˆÙ… Ù…ÙˆÙ‚Ø¹Ù†Ø§ Ø¨Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø±Ø§Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„ÙŠØ¹Ù…Ù„ ÙÙˆØ±Ø§Ù‹!</div>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" class="search-box" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø±ÙˆØ§ÙŠØ© Ø£Ùˆ ÙƒØ§ØªØ¨ ÙÙŠ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø­Ø±ÙŠØ±...">
    </div>

    <div id="publishSection" class="publish-box">
        <h2 style="text-align:center; color: var(--accent);">ğŸ–‹ï¸ Ø§Ù†Ø´Ø± Ø£Ø³Ø·ÙˆØ±ØªÙƒ Ø§Ù„Ø¢Ù†</h2>
        <input type="text" id="title" placeholder="Ø§Ø³Ù… Ø§Ù„Ø±ÙˆØ§ÙŠØ©">
        <input type="text" id="cover" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù">
        <input type="text" id="pdfLink" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· Google Drive Ù‡Ù†Ø§">
        <textarea id="idea" rows="3" placeholder="Ù†Ø¨Ø°Ø© Ù…Ø´ÙˆÙ‚Ø© Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„..."></textarea>
        <button id="submitBtn">ØªØ¹Ù…ÙŠØ¯ ÙˆÙ†Ø´Ø± Ø§Ù„Ø¹Ù…Ù„ âš¡</button>
    </div>

    <div id="storiesContainer" class="stories-grid"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, updateDoc, doc, increment, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCqosyyE5ievwHPrfa6oJL2FD7uAjY2Y5I",
        authDomain: "rj-pad.firebaseapp.com",
        projectId: "rj-pad",
        storageBucket: "rj-pad.firebasestorage.app",
        messagingSenderId: "160358264882",
        appId: "1:160358264882:web:c243cda30c359266ed4c2b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // Ø¯Ø§Ù„Ø© Ø°ÙƒÙŠØ© Ù„Ø¥ØµÙ„Ø§Ø­ Ø±ÙˆØ§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    function fixDriveLink(url) {
        if (url.includes("drive.google.com")) {
            const match = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
            if (match && match[1]) return `https://drive.google.com/uc?export=view&id=${match[1]}`;
        }
        return url;
    }

    // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ
    document.getElementById('searchInput').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        document.querySelectorAll('.story-card').forEach(card => {
            const title = card.querySelector('h3').innerText.toLowerCase();
            const author = card.querySelector('p').innerText.toLowerCase();
            card.style.display = (title.includes(term) || author.includes(term)) ? 'block' : 'none';
        });
    });

    document.getElementById('loginBtn').onclick = () => signInWithPopup(auth, provider);

    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('publishSection').style.display = 'block';
        }
    });

    document.getElementById('submitBtn').onclick = async () => {
        const title = document.getElementById('title').value;
        const cover = document.getElementById('cover').value;
        let pdf = document.getElementById('pdfLink').value;
        const idea = document.getElementById('idea').value;

        if (title && cover && pdf && idea) {
            pdf = fixDriveLink(pdf);
            await addDoc(collection(db, "stories"), {
                title, cover, pdf, idea,
                author: auth.currentUser.displayName,
                authorId: auth.currentUser.uid,
                views: 0,
                createdAt: serverTimestamp()
            });
            alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø­Ø±ÙŠØ±!");
            location.reload();
        }
    };

    onSnapshot(query(collection(db, "stories"), orderBy("createdAt", "desc")), (snap) => {
        const container = document.getElementById('storiesContainer');
        container.innerHTML = '';
        snap.forEach((sDoc) => {
            const data = sDoc.data();
            const isOwner = auth.currentUser && auth.currentUser.uid === data.authorId;
            container.innerHTML += `
                <div class="story-card">
                    <img src="${data.cover}" class="story-cover" onerror="this.src='https://via.placeholder.com/400x600/000/fff?text=Silk+Library'">
                    <div class="story-info">
                        <h3 style="margin:0; color:#ff4d4d;">${data.title}</h3>
                        <p style="font-size:0.8rem; color:gray; margin:5px 0;">Ø§Ù„ÙƒØ§ØªØ¨: ${data.author}</p>
                        <div style="font-size:0.85rem; color:#bbb; height:45px; overflow:hidden;">${data.idea}</div>
                        <div style="margin-top:10px; font-weight:bold;">ğŸ‘ï¸ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª: ${data.views || 0}</div>
                        <a href="${data.pdf}" target="_blank" rel="noopener noreferrer" class="btn-read" onclick="window.safeView('${sDoc.id}')">ğŸ“– Ø§Ù‚Ø±Ø£ Ø§Ù„Ø±ÙˆØ§ÙŠØ©</a>
                        ${isOwner ? `<button class="delete-btn" onclick="window.deleteStory('${sDoc.id}')">ğŸ—‘ï¸ Ø­Ø°Ù Ø±ÙˆØ§ÙŠØªÙŠ</button>` : ''}
                    </div>
                </div>`;
        });
    });

    window.safeView = async (id) => {
        const key = 'v_' + id;
        if (!sessionStorage.getItem(key)) {
            await updateDoc(doc(db, "stories", id), { views: increment(1) });
            sessionStorage.setItem(key, '1');
        }
    };

    window.deleteStory = async (id) => {
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±ÙˆØ§ÙŠØ© Ù…Ù† Ø§Ù„Ù…ÙƒØªØ¨Ø©ØŸ")) await deleteDoc(doc(db, "stories", id));
    };
</script>
</body>
</html>
