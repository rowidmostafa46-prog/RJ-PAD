<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RJ PAD | Ù…Ù…Ù„ÙƒÙ€Ø© Ø§Ù„Ø¥Ø¨Ù€Ø¯Ø§Ø¹</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #050505; --accent: #8b0000; --text: #e0e0e0; --card: #121212; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Cairo', sans-serif; margin: 0; }
        header { background: linear-gradient(135deg, #000, var(--accent)); padding: 50px 20px; text-align: center; border-bottom: 4px solid var(--accent); box-shadow: 0 5px 20px rgba(255,0,0,0.2); }
        .logo { font-size: 4rem; font-weight: 900; letter-spacing: 10px; text-shadow: 0 0 20px #ff0000; margin: 0; }
        .container { max-width: 1200px; margin: auto; padding: 20px; }
        
        .publish-box { background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid var(--accent); margin-bottom: 50px; display: none; box-shadow: 0 0 30px rgba(139, 0, 0, 0.1); }
        input, textarea, select { width: 100%; padding: 15px; margin: 10px 0; background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 8px; font-family: 'Cairo'; box-sizing: border-box; }
        .publish-box button { background: var(--accent); color: white; border: none; padding: 15px; cursor: pointer; font-weight: bold; border-radius: 8px; width: 100%; font-size: 1.2rem; transition: 0.3s; }
        .publish-box button:hover { background: #ff0000; box-shadow: 0 0 20px #ff0000; }

        .stories-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 30px; }
        .story-card { background: var(--card); border-radius: 15px; overflow: hidden; border: 1px solid #222; transition: 0.4s; position: relative; display: flex; flex-direction: column; }
        .story-card:hover { transform: translateY(-10px); border-color: var(--accent); }
        .story-cover { width: 100%; height: 400px; object-fit: cover; }
        
        .story-stats { display: flex; justify-content: space-around; padding: 10px; background: rgba(0,0,0,0.7); font-size: 0.85rem; border-bottom: 1px solid #222; }
        .stat-item { display: flex; align-items: center; gap: 5px; }

        .story-info { padding: 20px; flex-grow: 1; }
        .story-title { font-size: 1.6rem; color: #ff4d4d; margin: 0 0 10px 0; font-weight: 900; }
        .story-idea { font-size: 0.95rem; color: #bbb; line-height: 1.6; height: 60px; overflow: hidden; margin-bottom: 15px; }
        
        .actions { display: flex; gap: 10px; margin-bottom: 15px; }
        .btn-action { flex: 1; padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-family: 'Cairo'; transition: 0.2s; font-size: 0.9rem; }
        .btn-like { background: #333; color: #ff4d4d; border: 1px solid #ff4d4d; }
        .btn-read { background: #ff4d4d; color: #fff; text-decoration: none; text-align: center; line-height: 25px; }

        .rating-select { background: #111; color: gold; border: 1px solid #444; padding: 5px; border-radius: 5px; cursor: pointer; }

        .comments-section { padding: 15px; background: #0a0a0a; border-top: 1px solid #222; max-height: 150px; overflow-y: auto; font-size: 0.85rem; }
        .comment { margin-bottom: 8px; border-bottom: 1px solid #1a1a1a; padding-bottom: 5px; }
        .comment b { color: var(--accent); }
        
        .comment-input-group { display: flex; gap: 5px; padding: 10px; background: #121212; }
        .comment-input { flex: 1; padding: 10px; background: #000; border: 1px solid #333; color: #fff; border-radius: 4px; font-family: 'Cairo'; }

        #loginBtn { background: #fff; color: #000; border: none; padding: 12px 25px; font-weight: 900; border-radius: 30px; cursor: pointer; margin-top: 20px; font-size: 1rem; }
    </style>
</head>
<body>

<header>
    <h1 class="logo">RJ PAD</h1>
    <p>âš¡ Ø­Ù€ÙŠØ« ØªÙ€ÙˆÙ„Ø¯ Ø§Ù„Ø£Ø³Ù€Ø§Ø·ÙŠØ± ÙˆØªÙÙ€Ø®Ù„Ø¯ Ø§Ù„Ù€Ø±ÙˆØ§ÙŠØ§Øª âš¡</p>
    <button id="loginBtn">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ØµÙ„ÙŠÙ† Ù„Ù„Ø¥Ø¨Ø¯Ø§Ø¹ (Google)</button>
</header>

<div class="container">
    <div id="publishSection" class="publish-box">
        <h2 style="text-align:center; color: var(--accent);">ğŸ–‹ï¸ Ø§Ù†Ø´Ø± Ø¹Ù…Ù„Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯</h2>
        <input type="text" id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±ÙˆØ§ÙŠØ© / Ø§Ù„Ù…Ø§Ù†Ø¬Ø§">
        <input type="text" id="cover" placeholder="Ø±Ø§Ø¨Ø· ØºÙ„Ø§Ù Ø§Ù„Ø±ÙˆØ§ÙŠØ© (URL)">
        <input type="text" id="pdfLink" placeholder="Ø±Ø§Ø¨Ø· Ù…Ù„Ù Ø§Ù„Ù€ PDF Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©">
        <textarea id="idea" rows="3" placeholder="Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø© ØªØ´ÙˆÙ‚ Ø§Ù„Ù‚Ø±Ø§Ø¡..."></textarea>
        <button id="submitBtn">ØªÙ€Ø¹Ù…ÙŠØ¯ Ø§Ù„Ø±ÙˆØ§ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù€Ø®Ø²Ù† âš¡</button>
    </div>

    <div id="storiesContainer" class="stories-grid"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, updateDoc, doc, arrayUnion, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCqosyyE5ievwHPrfa6oJL2FD7uAjY2Y5I",
        authDomain: "rj-pad.firebaseapp.com",
        projectId: "rj-pad",
        storageBucket: "rj-pad.firebasestorage.app",
        messagingSenderId: "160358264882",
        appId: "1:160358264882:web:c243cda30c359266ed4c2b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    document.getElementById('loginBtn').onclick = () => signInWithPopup(auth, provider);

    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('publishSection').style.display = 'block';
        }
    });

    document.getElementById('submitBtn').onclick = async () => {
        const title = document.getElementById('title').value;
        const cover = document.getElementById('cover').value;
        const pdf = document.getElementById('pdfLink').value;
        const idea = document.getElementById('idea').value;
        if (title && cover && pdf && idea) {
            await addDoc(collection(db, "stories"), {
                title, cover, pdf, idea,
                author: auth.currentUser.displayName,
                views: 0, likes: 0, ratingSum: 5, ratingCount: 1,
                comments: [],
                createdAt: serverTimestamp()
            });
            alert("ØªÙ… Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø±ÙˆØ§ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­! âš¡");
            location.reload();
        }
    };

    onSnapshot(query(collection(db, "stories"), orderBy("createdAt", "desc")), (snapshot) => {
        const container = document.getElementById('storiesContainer');
        container.innerHTML = '';
        snapshot.forEach((sDoc) => {
            const data = sDoc.data();
            const sId = sDoc.id;
            const avgRating = (data.ratingSum / data.ratingCount).toFixed(1);
            
            const card = document.createElement('div');
            card.className = 'story-card';
            card.innerHTML = `
                <img src="${data.cover}" class="story-cover" onerror="this.src='https://via.placeholder.com/400x600/000/fff?text=RJ+PAD'">
                <div class="story-stats">
                    <div class="stat-item">ğŸ‘ï¸ ${data.views || 0}</div>
                    <div class="stat-item">â¤ï¸ ${data.likes || 0}</div>
                    <div class="stat-item">â­ ${avgRating}/5</div>
                </div>
                <div class="story-info">
                    <h3 class="story-title">${data.title}</h3>
                    <p class="story-idea">${data.idea}</p>
                    <div class="actions">
                        <button class="btn-action btn-like" onclick="window.likeStory('${sId}')">â¤ï¸ Ø¥Ø¹Ø¬Ø§Ø¨</button>
                        <select class="rating-select" onchange="window.rateStory('${sId}', this.value)">
                            <option value="">â­ Ù‚ÙŠÙ…</option>
                            <option value="5">5 Ù†Ø¬ÙˆÙ…</option>
                            <option value="4">4 Ù†Ø¬ÙˆÙ…</option>
                            <option value="3">3 Ù†Ø¬ÙˆÙ…</option>
                            <option value="2">2 Ù†Ø¬ÙˆÙ…</option>
                            <option value="1">Ù†Ø¬Ù…Ø© ÙˆØ§Ø­Ø¯Ø©</option>
                        </select>
                        <a href="${data.pdf}" target="_blank" class="btn-action btn-read" onclick="window.addView('${sId}')">ğŸ“– Ø§Ù‚Ø±Ø£</a>
                    </div>
                </div>
                <div class="comments-section">
                    ${(data.comments || []).slice(-5).map(c => `<div class="comment"><b>${c.user}:</b> ${c.text}</div>`).join('')}
                </div>
                <div class="comment-input-group">
                    <input type="text" class="comment-input" id="inp-${sId}" placeholder="Ø¹Ù„Ù‚ ÙƒÙ€Ø£Ø³Ø·ÙˆØ±Ø©...">
                    <button onclick="window.addComment('${sId}')" style="background:var(--accent); color:#fff; border:none; padding:5px 15px; border-radius:4px; cursor:pointer; font-family:'Cairo';">Ø¥Ø±Ø³Ø§Ù„</button>
                </div>
            `;
            container.appendChild(card);
        });
    });

    // Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©
    window.addView = async (id) => { await updateDoc(doc(db, "stories", id), { views: increment(1) }); };
    window.likeStory = async (id) => { await updateDoc(doc(db, "stories", id), { likes: increment(1) }); };
    window.rateStory = async (id, val) => {
        if(val) {
            await updateDoc(doc(db, "stories", id), { 
                ratingSum: increment(Number(val)), 
                ratingCount: increment(1) 
            });
            alert("Ø´ÙƒØ±Ø§Ù‹ Ù„ØªÙ‚ÙŠÙŠÙ…Ùƒ!");
        }
    };
    window.addComment = async (id) => {
        const text = document.getElementById(`inp-${id}`).value;
        if(text && auth.currentUser) {
            await updateDoc(doc(db, "stories", id), {
                comments: arrayUnion({ user: auth.currentUser.displayName, text: text })
            });
            document.getElementById(`inp-${id}`).value = '';
        } else { alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹!"); }
    };
</script>
</body>
</html>
