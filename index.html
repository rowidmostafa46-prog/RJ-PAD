<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RJ PAD |Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø­Ø±ÙŠØ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #050505; --accent: #8b0000; --text: #e0e0e0; --card: #121212; --gold: #ffd700; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Cairo', sans-serif; margin: 0; }
        header { background: linear-gradient(135deg, #000, var(--accent)); padding: 40px 20px; text-align: center; border-bottom: 4px solid var(--accent); }
        .logo { font-size: 3.5rem; font-weight: 900; letter-spacing: 10px; text-shadow: 0 0 20px #ff0000; }
        .container { max-width: 1200px; margin: auto; padding: 20px; }

        /* Ù‚Ø³Ù… Ø´Ø±Ø­ Ø§Ù„Ø±ÙØ¹ */
        .tutorial-box { background: #1a1a1a; padding: 25px; border-radius: 15px; border: 1px solid var(--gold); margin-bottom: 30px; box-shadow: inset 0 0 10px rgba(255, 215, 0, 0.1); }
        .tutorial-box h3 { color: var(--gold); margin-top: 0; display: flex; align-items: center; gap: 10px; }
        .tutorial-box p { font-size: 0.9rem; line-height: 1.6; color: #ccc; }
        .guide-steps { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; }
        .step-card { background: #222; padding: 10px; border-radius: 8px; font-size: 0.85rem; border: 1px solid #333; }
        .step-card b { color: var(--gold); display: block; margin-bottom: 5px; }

        /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± */
        .publish-box { background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid var(--accent); margin-bottom: 50px; display: none; }
        input, textarea { width: 100%; padding: 15px; margin: 10px 0; background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 8px; box-sizing: border-box; font-family: 'Cairo'; }
        #submitBtn { background: var(--accent); color: white; border: none; padding: 15px; cursor: pointer; font-weight: bold; border-radius: 8px; width: 100%; font-size: 1.2rem; transition: 0.3s; }
        #submitBtn:hover { background: #ff0000; box-shadow: 0 0 15px #ff0000; }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø±ÙˆØ§ÙŠØ§Øª */
        .stories-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }
        .story-card { background: var(--card); border-radius: 15px; overflow: hidden; border: 1px solid #222; transition: 0.3s; }
        .story-card:hover { transform: translateY(-5px); border-color: var(--accent); }
        .story-cover { width: 100%; height: 400px; object-fit: cover; }
        .story-info { padding: 20px; }
        .story-title { font-size: 1.4rem; color: #ff4d4d; margin: 0; font-weight: 700; }
        
        .btn-read { display: block; background: #ff4d4d; color: #fff; text-align: center; padding: 12px; text-decoration: none; font-weight: bold; border-radius: 8px; margin-top: 15px; transition: 0.2s; }
        .btn-read:hover { background: #fff; color: #ff4d4d; }
        
        .delete-btn { background: transparent; color: #666; border: 1px solid #333; padding: 5px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 10px; font-size: 0.8rem; }
        .delete-btn:hover { color: #ff0000; border-color: #ff0000; }

        #loginBtn { background: #fff; color: #000; padding: 12px 30px; border-radius: 30px; cursor: pointer; border: none; font-weight: 900; margin-top: 20px; box-shadow: 0 0 15px rgba(255,255,255,0.3); }
    </style>
</head>
<body>

<header>
    <div class="logo">RJ PAD</div>
    <p>âš¡ Ù…Ù†ØµØ© Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ±: Ø§Ù‚Ø±Ø£ØŒ Ø§Ù†Ø´Ø±ØŒ ÙˆØ®Ù„Ù‘Ø¯ Ø§Ø³Ù…Ùƒ âš¡</p>
    <button id="loginBtn">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø¯Ø¹ÙŠÙ† (Google)</button>
</header>

<div class="container">
    <div class="tutorial-box">
        <h3>âš ï¸ ÙƒÙŠÙ ØªØ¶Ù…Ù† ÙØªØ­ Ø±ÙˆØ§ÙŠØªÙƒ Ù„Ù„Ù‚Ø±Ø§Ø¡ØŸ</h3>
        <p>Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ù„Ø§ ØªØ¹Ù…Ù„ Ø£Ø­ÙŠØ§Ù†Ø§Ù‹. Ø§ØªØ¨Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ù„Ø¶Ù…Ø§Ù† Ø£Ù† ÙŠÙ‚Ø±Ø£ Ø§Ù„Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„Ùƒ:</p>
        <div class="guide-steps">
            <div class="step-card">
                <b>1. Ø§Ù„Ø±ÙØ¹</b>
                Ø§Ø±ÙØ¹ Ø§Ù„Ù€ PDF Ø¹Ù„Ù‰ Google Drive.
            </div>
            <div class="step-card">
                <b>2. Ø§Ù„Ø¥Ø°Ù† (Ù…Ù‡Ù…!)</b>
                Ø§Ø¶ØºØ· Share ÙˆØ§Ø¬Ø¹Ù„ Ø§Ù„ÙˆØµÙˆÙ„ <b>Anyone with the link</b>.
            </div>
            <div class="step-card">
                <b>3. Ø§Ù„Ø±Ø§Ø¨Ø·</b>
                Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ¶Ø¹Ù‡ Ù‡Ù†Ø§. Ø³ÙŠÙ‚ÙˆÙ… Ù…ÙˆÙ‚Ø¹Ù†Ø§ Ø¨Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØµÙ„Ø§Ø­Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.
            </div>
        </div>
    </div>

    <div id="publishSection" class="publish-box">
        <h2 style="text-align:center; color: var(--accent);">ğŸ–‹ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ù†Ø´Ø±</h2>
        <input type="text" id="title" placeholder="Ø§Ø³Ù… Ø§Ù„Ø±ÙˆØ§ÙŠØ©">
        <input type="text" id="cover" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù">
        <input type="text" id="pdfLink" placeholder="Ø±Ø§Ø¨Ø· Ù…Ù„Ù Ø§Ù„Ù€ PDF Ù…Ù† Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ">
        <textarea id="idea" rows="3" placeholder="Ù†Ø¨Ø°Ø© Ù…Ø´ÙˆÙ‚Ø© Ø¹Ù† Ø§Ù„Ù‚ØµØ©..."></textarea>
        <button id="submitBtn">Ù†Ø´Ø± Ø§Ù„Ø±ÙˆØ§ÙŠØ© Ø§Ù„Ø¢Ù† âš¡</button>
    </div>

    <div id="storiesContainer" class="stories-grid"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, updateDoc, doc, increment, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCqosyyE5ievwHPrfa6oJL2FD7uAjY2Y5I",
        authDomain: "rj-pad.firebaseapp.com",
        projectId: "rj-pad",
        storageBucket: "rj-pad.firebasestorage.app",
        messagingSenderId: "160358264882",
        appId: "1:160358264882:web:c243cda30c359266ed4c2b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // ÙˆØ¸ÙŠÙØ© Ø°ÙƒÙŠØ© Ù„ØªØµÙ„ÙŠØ­ Ø±ÙˆØ§Ø¨Ø· Ø¬ÙˆØ¬Ù„ Ø¯Ø±Ø§ÙŠÙ
    function fixDriveLink(url) {
        if (url.includes("drive.google.com")) {
            const parts = url.split("/");
            const idIndex = parts.indexOf("d") + 1;
            if (idIndex > 0) {
                const id = parts[idIndex];
                return `https://drive.google.com/uc?export=view&id=${id}`;
            }
        }
        return url;
    }

    document.getElementById('loginBtn').onclick = () => signInWithPopup(auth, provider);

    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('publishSection').style.display = 'block';
        }
    });

    document.getElementById('submitBtn').onclick = async () => {
        const title = document.getElementById('title').value;
        const cover = document.getElementById('cover').value;
        let pdf = document.getElementById('pdfLink').value;
        const idea = document.getElementById('idea').value;

        if (title && cover && pdf && idea) {
            pdf = fixDriveLink(pdf); // ØªØµÙ„ÙŠØ­ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸
            await addDoc(collection(db, "stories"), {
                title, cover, pdf, idea,
                author: auth.currentUser.displayName,
                authorId: auth.currentUser.uid,
                views: 0,
                createdAt: serverTimestamp()
            });
            alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ø±ÙˆØ§ÙŠØ© Ø³ØªØ¸Ù‡Ø± ÙÙˆØ±Ø§Ù‹.");
            location.reload();
        } else { alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!"); }
    };

    onSnapshot(query(collection(db, "stories"), orderBy("createdAt", "desc")), (snap) => {
        const container = document.getElementById('storiesContainer');
        container.innerHTML = '';
        snap.forEach((sDoc) => {
            const data = sDoc.data();
            const sId = sDoc.id;
            const isOwner = auth.currentUser && auth.currentUser.uid === data.authorId;
            
            container.innerHTML += `
                <div class="story-card">
                    <img src="${data.cover}" class="story-cover" onerror="this.src='https://via.placeholder.com/400x600/000/fff?text=RJ+PAD'">
                    <div class="story-info">
                        <h3 class="story-title">${data.title}</h3>
                        <p style="font-size:0.8rem; color:gray; margin-bottom:10px;">Ø¨ÙˆØ§Ø³Ø·Ø©: ${data.author}</p>
                        <div style="font-size:0.9rem; color:#bbb; height:45px; overflow:hidden;">${data.idea}</div>
                        <div style="margin-top:10px; font-weight:bold;">ğŸ‘ï¸ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª: ${data.views || 0}</div>
                        <a href="${data.pdf}" target="_blank" rel="noopener noreferrer" class="btn-read" onclick="window.safeView('${sId}')">ğŸ“– Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±ÙˆØ§ÙŠØ©</a>
                        ${isOwner ? `<button class="delete-btn" onclick="window.deleteStory('${sId}')">ğŸ—‘ï¸ Ø­Ø°Ù Ø±ÙˆØ§ÙŠØªÙŠ</button>` : ''}
                    </div>
                </div>`;
        });
    });

    window.safeView = async (id) => {
        const viewKey = 'v_' + id;
        if (!sessionStorage.getItem(viewKey)) {
            await updateDoc(doc(db, "stories", id), { views: increment(1) });
            sessionStorage.setItem(viewKey, '1');
        }
    };

    window.deleteStory = async (id) => {
        if (confirm("Ø­Ø°Ù Ø§Ù„Ø±ÙˆØ§ÙŠØ© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            await deleteDoc(doc(db, "stories", id));
        }
    };
</script>
</body>
</html>
